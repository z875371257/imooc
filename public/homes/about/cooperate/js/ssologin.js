function SSOController(){var k=this;var n={success:function(A){},error:function(){},complete:function(){}};var s="ssoLoginFrame";var p="ssoLoginForm";var g="";var e="";var v=0;var h=0;var f=null;var m=null;var b=0;var a={};var w="/passport/user/login";var r="/passport/user/register";var y="/passport/user/prelogin";this.verifyCodeUrl="/passport/user/verifycode";this.checkVerifyUrl="/passport/user/loginverifyshow";this.checkVerifyCode="/passport/user/verifycheck";this.checkUserName="/passport/user/checkusername";this.checkNickName="/passport/user/checknickname";this.tpRegister="/passport/user/tpregister";this.tpBind="/passport/user/tpbind";var l=function(A){$(s).remove();var B=$("<iframe></iframe>");B.css("display","none");B.attr("id",A);B.attr("name",A);B.attr("src","javascript:void(0)");B.appendTo("body");return B};var o=function(B){$(p).remove();var C=$("<form></form>");C.attr("id",B);C.attr("name",B);C.attr("method","post");C.css("display","none");for(var A in a){C.append($("<input type='text' name='"+A+"' value='"+a[A]+"' />"))}C.appendTo("body");return C};var d=function(C,B,D){var A='<p class="warn-info" style="font-size: 16px;line-height: 28px;max-width: 600px;">'+C+"</p>";if(B&&typeof D!="undefined"){if(D=="imooc"){A+='<p class="warn-tip" style="color: #999;margin-top: 30px;">可能导致帐号冻结的原因  <a href="http://www.imooc.com/about/faq?t=5&id=13" target="_blank" style="color: #08c !important;">了解详情</a></p>'}else{A+='<p class="warn-tip" style="color: #999;margin-top: 30px;">可能导致帐号冻结的原因  <a href="http://coding.imooc.com/user/faqdetail?column_id=2&id=17" target="_blank" style="color: #08c !important;">了解详情</a></p>'}}A+='<div class="moco-modal-btns"><a class="moco-btn moco-btn-blue moco-modal-close js-modal-close" href="javascript:void(0)"><span>确定</span></a></div>';return A};var z=function(){if(typeof XMLHttpRequest=="undefined"){return false}var A=new XMLHttpRequest();if(!"withCredentials" in A){return false}$.ajax({url:w,data:a,method:"post",dataType:"json",xhrFields:{withCredentials:true},success:function(B){var C=function(){if(window.location.href.indexOf("newlogin/from_url")>0){window.location.reload();return false}};if(B.status==10020){var D="";var E="十分抱歉，由于您的帐号最近在实战中存在严重违规的情况，已做冻结帐号处理";D=d(E,true,"shizhan");if($.dialog){$.dialog(D,{title:"提示",modal:true,callback:C})}else{alert(E);C()}$("#signin").remove();$(".modal-backdrop").remove()}else{if(B.status==10021){var D="";var E="十分抱歉，由于您的账号最近在实战中被多次警告，已做冻结账号处理";D=d(E,true,"shizhan");if($.dialog){$.dialog(D,{title:"提示",modal:true,callback:C})}else{alert(E);C()}$("#signin").remove();$(".modal-backdrop").remove()}else{if(B.status==10022){var D="";var E="十分抱歉，由于您的账号最近在慕课网被多次警告，已做冻结账号处理";D=d(E,true,"imooc");if($.dialog){$.dialog(D,{title:"提示",modal:true,callback:C})}else{alert(E);C()}$("#signin").remove();$(".modal-backdrop").remove()}else{if(B.status==10006){var D="";var E="十分抱歉，由于您的帐号最近在慕课网中存在严重违规的情况，已做冻结帐号处理";D=d(E,true,"imooc");if($.dialog){$.dialog(D,{title:"提示",modal:true,callback:C})}else{alert(E);C()}$("#signin").remove();$(".modal-backdrop").remove()}else{if(B.status==10001){if(B.caution){var D=d(B.caution,false);$("#signin").remove();$(".modal-backdrop").remove();if($.dialog){$.dialog(D,{title:"提示",modal:true,callback:function(){window.location.href="http://www.imooc.com/index/usercheck?uid="+B.data.userInfo.uid}})}else{alert(B.caution);window.location.href="http://www.imooc.com/index/usercheck?uid="+B.data.userInfo.uid}}else{k.ssoLoginCallBack(B)}}else{k.ssoLoginCallBack(B)}}}}}},error:function(){a.returntype="html";u()}});return true};var q=function(){if(typeof XMLHttpRequest=="undefined"){return false}var A=new XMLHttpRequest();$.ajax({url:r,data:a,method:"post",dataType:"json",success:function(B){k.ssoLoginCallBack(B)},error:function(){a.returntype="html";t()}});return true};var u=function(){l(s);var B=o(p);B.attr("action",w);B.attr("target",s);try{B.submit()}catch(A){$(s).remove()}setTimeout(function(){$(B).remove()},10)};var t=function(){l(s);var B=o(p);B.attr("action",r);B.attr("target",s);try{B.submit()}catch(A){$(s).remove()}setTimeout(function(){$(B).remove()},10)};var c=function(A){clearInterval(h);h=null;g=A.pubkey;e=A.code;v=A.servertime;setInterval(function(){v++},1000)};this.preLogin=function(A){if(g&&e){A.success&&A.success();return}A=A||{success:function(){},error:function(){}};$.ajax({url:y,method:"post",dataType:"json",success:function(B){if(B.status==10001){c(B);A.success&&A.success()}else{A.error&&A.error()}},error:function(){A.error()}})};this.setCrossDomainCookie=function(B){b=B.length;for(var A=0;A<B.length;A++){url=B[A];$.get(url,function(C){b--;if(b==0){clearTimeout(m);k.crossDomainResult()}},"jsonp")}};this.ssoLoginCallBack=function(A){if(A.status==10001){f=function(){n.success(A);n.complete()};this.setCrossDomainCookie(A.data.url);m=setTimeout(function(){k.crossDomainResult()},5000)}else{n.success(A);n.complete()}};this.crossDomainResult=function(){if(typeof f=="function"){f()}};this.crossDomainAction=function(A){if(typeof A=="function"){f=A}m=setTimeout(function(){k.crossDomainResult()},5000);return false};this.frameLoginCallBack=function(A){n.success(A);n.complete();$(s).remove()};this.login=function(B){if(B.data.pwencode){if(e==""||v==0||g==""){B.error();B.complete();this.preLogin();return}var A=x(e+"\t"+v+"\t"+B.data.password);B.data.password=window.btoa(A)}a=B.data;a.referer=window.location.protocol+"//"+window.location.hostname;n={success:B.success,error:B.error,complete:B.complete};if(z()){return true}else{a.returntype="html";u()}};this.register=function(A){n={success:A.success,error:A.error,complete:A.complete};a=A.data;a.referer=window.location.protocol+"//"+window.location.hostname;if(q()){return true}else{a.returntype="html";t()}};var x=function(am){var aI=2;var ah=16;var J=ah;var Q=1<<16;var D=Q>>>1;var an=Q*Q;var av=Q-1;var B=9999999999999998;var L;var aG;var aA,aE;function P(aL){L=aL;aG=new Array(L);for(var aK=0;aK<aG.length;aK++){aG[aK]=0}aA=new A();aE=new A();aE.digits[0]=1}P(20);var aj=15;var ao=ax(1000000000000000);function A(aK){if(typeof aK=="boolean"&&aK==true){this.digits=null}else{this.digits=aG.slice(0)}this.isNeg=false}function M(aN){var aM=aN.charAt(0)=="-";var aK=aM?1:0;var aO;while(aK<aN.length&&aN.charAt(aK)=="0"){++aK}if(aK==aN.length){aO=new A()}else{var aL=aN.length-aK;var aP=aL%aj;if(aP==0){aP=aj}aO=ax(Number(aN.substr(aK,aP)));aK+=aP;while(aK<aN.length){aO=E(aJ(aO,ao),ax(Number(aN.substr(aK,aj))));aK+=aj}aO.isNeg=aM}return aO}function S(aK){var aL=new A(true);aL.digits=aK.digits.slice(0);aL.isNeg=aK.isNeg;return aL}function ax(aL){var aM=new A();aM.isNeg=aL<0;aL=Math.abs(aL);var aK=0;while(aL>0){aM.digits[aK++]=aL&av;aL>>=ah}return aM}function ak(aL){var aM="";for(var aK=aL.length-1;aK>-1;--aK){aM+=aL.charAt(aK)}return aM}var C=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");function R(aL,aN){var aK=new A();aK.digits[0]=aN;var aM=al(aL,aK);var aO=C[aM[1].digits[0]];while(aD(aM[0],aA)==1){aM=al(aM[0],aK);digit=aM[1].digits[0];aO+=C[aM[1].digits[0]]}return(aL.isNeg?"-":"")+ak(aO)}function aH(aL){var aK=new A();aK.digits[0]=10;var aM=al(aL,aK);var aN=String(aM[1].digits[0]);while(aD(aM[0],aA)==1){aM=al(aM[0],aK);aN+=String(aM[1].digits[0])}return(aL.isNeg?"-":"")+ak(aN)}var aC=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");function O(aM){var aK=15;var aL="";for(i=0;i<4;++i){aL+=aC[aM&aK];aM>>>=4}return ak(aL)}function ae(aK){var aM="";var aN=aw(aK);for(var aL=aw(aK);aL>-1;--aL){aM+=O(aK.digits[aL])}return aM}function X(aR){var aL=48;var aK=aL+9;var aM=97;var aQ=aM+25;var aP=65;var aN=65+25;var aO;if(aR>=aL&&aR<=aK){aO=aR-aL}else{if(aR>=aP&&aR<=aN){aO=10+aR-aP}else{if(aR>=aM&&aR<=aQ){aO=10+aR-aM}else{aO=0}}}return aO}function V(aM){var aN=0;var aK=Math.min(aM.length,4);for(var aL=0;aL<aK;++aL){aN<<=4;aN|=X(aM.charCodeAt(aL))}return aN}function K(aN){var aO=new A();var aK=aN.length;for(var aM=aK,aL=0;aM>0;aM-=4,++aL){aO.digits[aL]=V(aN.substr(Math.max(aM-4,0),Math.min(aM,4)))}return aO}function ad(aT,aR){var aK=aT.charAt(0)=="-";var aN=aK?1:0;var aQ=new A();var aL=new A();aL.digits[0]=1;for(var aM=aT.length-1;aM>=aN;aM--){var aO=aT.charCodeAt(aM);var aP=X(aO);var aS=G(aL,aP);aQ=E(aQ,aS);aL=G(aL,aR)}aQ.isNeg=aK;return aQ}function aa(aK){var aM="";for(var aL=aw(aK);aL>-1;--aL){aM+=Y(aK.digits[aL])}return aM}function Y(aM){var aL=String.fromCharCode(aM&255);aM>>>=8;var aK=String.fromCharCode(aM&255);return aK+aL}function ab(aK){return(aK.isNeg?"-":"")+aK.digits.join(" ")}function E(aK,aP){var aM;if(aK.isNeg!=aP.isNeg){aP.isNeg=!aP.isNeg;aM=N(aK,aP);aP.isNeg=!aP.isNeg}else{aM=new A();var aO=0;var aN;for(var aL=0;aL<aK.digits.length;++aL){aN=aK.digits[aL]+aP.digits[aL]+aO;aM.digits[aL]=aN&65535;aO=Number(aN>=Q)}aM.isNeg=aK.isNeg}return aM}function N(aK,aP){var aM;if(aK.isNeg!=aP.isNeg){aP.isNeg=!aP.isNeg;aM=E(aK,aP);aP.isNeg=!aP.isNeg}else{aM=new A();var aO,aN;aN=0;for(var aL=0;aL<aK.digits.length;++aL){aO=aK.digits[aL]-aP.digits[aL]+aN;aM.digits[aL]=aO&65535;if(aM.digits[aL]<0){aM.digits[aL]+=Q}aN=0-Number(aO<0)}if(aN==-1){aN=0;for(var aL=0;aL<aK.digits.length;++aL){aO=0-aM.digits[aL]+aN;aM.digits[aL]=aO&65535;if(aM.digits[aL]<0){aM.digits[aL]+=Q}aN=0-Number(aO<0)}aM.isNeg=!aK.isNeg}else{aM.isNeg=aK.isNeg}}return aM}function aw(aK){var aL=aK.digits.length-1;while(aL>0&&aK.digits[aL]==0){--aL}return aL}function ag(aL){var aO=aw(aL);var aN=aL.digits[aO];var aK=(aO+1)*J;var aM;for(aM=aK;aM>aK-J;--aM){if((aN&32768)!=0){break}aN<<=1}return aM}function aJ(aR,aQ){var aP=new A();var aO;var aL=aw(aR);var aT=aw(aQ);var aS,aK,aM;for(var aN=0;aN<=aT;++aN){aO=0;aM=aN;for(j=0;j<=aL;++j,++aM){aK=aP.digits[aM]+aR.digits[j]*aQ.digits[aN]+aO;aP.digits[aM]=aK&av;aO=aK>>>ah}aP.digits[aN+aL+1]=aO}aP.isNeg=aR.isNeg!=aQ.isNeg;return aP}function G(aK,aP){var aO,aN,aM;result=new A();aO=aw(aK);aN=0;for(var aL=0;aL<=aO;++aL){aM=result.digits[aL]+aK.digits[aL]*aP+aN;result.digits[aL]=aM&av;aN=aM>>>ah}result.digits[1+aO]=aN;return result}function ap(aP,aO,aM,aR,aQ){var aK=Math.min(aO+aQ,aP.length);for(var aN=aO,aL=aR;aN<aK;++aN,++aL){aM[aL]=aP[aN]}}var ay=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535);function at(aK,aR){var aN=Math.floor(aR/J);var aQ=new A();ap(aK.digits,0,aQ.digits,aN,aQ.digits.length-aN);var aP=aR%J;var aM=J-aP;for(var aL=aQ.digits.length-1,aO=aL-1;aL>0;--aL,--aO){aQ.digits[aL]=((aQ.digits[aL]<<aP)&av)|((aQ.digits[aO]&ay[aP])>>>(aM))}aQ.digits[0]=((aQ.digits[aL]<<aP)&av);aQ.isNeg=aK.isNeg;return aQ}var Z=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);function aB(aK,aR){var aM=Math.floor(aR/J);var aP=new A();ap(aK.digits,aM,aP.digits,0,aK.digits.length-aM);var aO=aR%J;var aQ=J-aO;for(var aL=0,aN=aL+1;aL<aP.digits.length-1;++aL,++aN){aP.digits[aL]=(aP.digits[aL]>>>aO)|((aP.digits[aN]&Z[aO])<<aQ)}aP.digits[aP.digits.length-1]>>>=aO;aP.isNeg=aK.isNeg;return aP}function ai(aK,aM){var aL=new A();ap(aK.digits,0,aL.digits,aM,aL.digits.length-aM);return aL}function F(aK,aM){var aL=new A();ap(aK.digits,aM,aL.digits,0,aL.digits.length-aM);return aL}function T(aK,aM){var aL=new A();ap(aK.digits,0,aL.digits,0,aM);return aL}function aD(aK,aM){if(aK.isNeg!=aM.isNeg){return 1-2*Number(aK.isNeg)}for(var aL=aK.digits.length-1;aL>=0;--aL){if(aK.digits[aL]!=aM.digits[aL]){if(aK.isNeg){return 1-2*Number(aK.digits[aL]>aM.digits[aL])}else{return 1-2*Number(aK.digits[aL]<aM.digits[aL])}}}return 0}function al(aQ,aP){var aL=ag(aQ);var aO=ag(aP);var aM=aP.isNeg;var aU,aS;if(aL<aO){if(aQ.isNeg){aU=S(aE);aU.isNeg=!aP.isNeg;aQ.isNeg=false;aP.isNeg=false;aS=N(aP,aQ);aQ.isNeg=true;aP.isNeg=aM}else{aU=new A();aS=S(aQ)}return new Array(aU,aS)}aU=new A();aS=aQ;var aR=Math.ceil(aO/J)-1;var aK=0;while(aP.digits[aR]<D){aP=at(aP,1);++aK;++aO;aR=Math.ceil(aO/J)-1}aS=at(aS,aK);aL+=aK;var aX=Math.ceil(aL/J)-1;var a2=ai(aP,aX-aR);while(aD(aS,a2)!=-1){++aU.digits[aX-aR];aS=N(aS,a2)}for(var a1=aX;a1>aR;--a1){var aT=(a1>=aS.digits.length)?0:aS.digits[a1];var a0=(a1-1>=aS.digits.length)?0:aS.digits[a1-1];var aZ=(a1-2>=aS.digits.length)?0:aS.digits[a1-2];var aY=(aR>=aP.digits.length)?0:aP.digits[aR];var aN=(aR-1>=aP.digits.length)?0:aP.digits[aR-1];if(aT==aY){aU.digits[a1-aR-1]=av}else{aU.digits[a1-aR-1]=Math.floor((aT*Q+a0)/aY)}var aW=aU.digits[a1-aR-1]*((aY*Q)+aN);var aV=(aT*an)+((a0*Q)+aZ);while(aW>aV){--aU.digits[a1-aR-1];aW=aU.digits[a1-aR-1]*((aY*Q)|aN);aV=(aT*Q*Q)+((a0*Q)+aZ)}a2=ai(aP,a1-aR-1);aS=N(aS,G(a2,aU.digits[a1-aR-1]));if(aS.isNeg){aS=E(aS,a2);--aU.digits[a1-aR-1]}}aS=aB(aS,aK);aU.isNeg=aQ.isNeg!=aM;if(aQ.isNeg){if(aM){aU=E(aU,aE)}else{aU=N(aU,aE)}aP=aB(aP,aK);aS=N(aP,aS)}if(aS.digits[0]==0&&aw(aS)==0){aS.isNeg=false}return new Array(aU,aS)}function H(aK,aL){return al(aK,aL)[0]}function W(aK,aL){return al(aK,aL)[1]}function ar(aL,aM,aK){return W(aJ(aL,aM),aK)}function af(aK,aN){var aM=aE;var aL=aK;while(true){if((aN&1)!=0){aM=aJ(aM,aL)}aN>>=1;if(aN==0){break}aL=aJ(aL,aL)}return aM}function ac(aL,aP,aK){var aO=aE;var aM=aL;var aN=aP;while(true){if((aN.digits[0]&1)!=0){aO=ar(aO,aM,aK)}aN=aB(aN,1);if(aN.digits[0]==0&&aw(aN)==0){break}aM=ar(aM,aM,aK)}return aO}function aF(aK){this.modulus=S(aK);this.k=aw(this.modulus)+1;var aL=new A();aL.digits[2*this.k]=1;this.mu=H(aL,this.modulus);this.bkplus1=new A();this.bkplus1.digits[this.k+1]=1;this.modulo=az;this.multiplyMod=U;this.powMod=aq}function az(aR){var aQ=F(aR,this.k-1);var aO=aJ(aQ,this.mu);var aN=F(aO,this.k+1);var aM=T(aR,this.k+1);var aS=aJ(aN,this.modulus);var aL=T(aS,this.k+1);var aK=N(aM,aL);if(aK.isNeg){aK=E(aK,this.bkplus1)}var aP=aD(aK,this.modulus)>=0;while(aP){aK=N(aK,this.modulus);aP=aD(aK,this.modulus)>=0}return aK}function U(aK,aM){var aL=aJ(aK,aM);return this.modulo(aL)}function aq(aK,aO){var aN=new A();aN.digits[0]=1;var aL=aK;var aM=aO;while(true){if((aM.digits[0]&1)!=0){aN=this.multiplyMod(aN,aL)}aM=aB(aM,1);if(aM.digits[0]==0&&aw(aM)==0){break}aL=this.multiplyMod(aL,aL)}return aN}function I(aL){var aK=1024;this.e=K("10001");this.d=K("");this.m=K(aL);if(typeof(aK)!="number"){this.chunkSize=2*aw(this.m)}else{this.chunkSize=aK/8}this.radix=16;this.barrett=new aF(this.m)}function au(aY){var aT=new Array();var aL=aY.length;var aP,aO,aN;var aK=2;var aX=1;var aQ;var aR;var aS="";var aM;var aW;var aV;var aU=new I(g);if(aL>(aU.chunkSize-11)){aL=aU.chunkSize-11}aP=0;aO=aL-1;while(aP<aL){aT[aO]=aY.charCodeAt(aP);aP++;aO--}aO=aU.chunkSize-(aL%aU.chunkSize);while(aO>0){aQ=Math.floor(Math.random()*256);while(!aQ){aQ=Math.floor(Math.random()*256)}aT[aP]=aQ;aP++;aO--}aT[aL]=0;aT[aU.chunkSize-2]=2;aT[aU.chunkSize-1]=0;aR=aT.length;for(aP=0;aP<aR;aP+=aU.chunkSize){aM=new A();aO=0;for(aN=aP;aN<(aP+aU.chunkSize);++aO){aM.digits[aO]=aT[aN++];aM.digits[aO]+=aT[aN++]<<8}aW=aU.barrett.powMod(aM,aU.e);aV=aa(aW);aS+=aV}return aS}P(131);return au(am)}}(function(){var a=typeof exports!="undefined"?exports:self;var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function c(d){this.message=d}c.prototype=new Error;c.prototype.name="InvalidCharacterError";a.btoa||(a.btoa=function(f){var l=String(f);for(var k,e,d=0,h=b,g="";l.charAt(d|0)||(h="=",d%1);g+=h.charAt(63&k>>8-d%1*8)){e=l.charCodeAt(d+=3/4);if(e>255){throw new c("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}k=k<<8|e}return g});a.atob||(a.atob=function(e){var l=String(e).replace(/=+$/,"");if(l.length%4==1){throw new c("'atob' failed: The string to be decoded is not correctly encoded.")}for(var k=0,f,h,d=0,g="";h=l.charAt(d++);~h&&(f=k%4?f*64+h:h,k++%4)?g+=String.fromCharCode(255&f>>(-2*k&6)):0){h=b.indexOf(h)}return g})}());imoocSSO=new SSOController();